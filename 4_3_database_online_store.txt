1. Вывести авторов и названия книг и их цену в двух столбцах - рубли и копейки.  Информацию отсортировать по убыванию копеек. 

Ответ:

SELECT author, title,
FLOOR(price) AS Рубли,
ROUND((price % 1) * 100) AS Копейки
FROM book
ORDER BY 4 DESC;

*****

2. В связи с повышенным спросом на классическую литературу школьниками в формате "А есть то же самое, но покороче, чтобы читать поменьше?" была выпущена серия "Графоман и. Краткое содержание".
В выборке:
- к имени автора добавить "Графоман и ";
- к названию книги дописать ". Краткое содержание.";
- цену на новый опус установить 40% от цены оригинала, но не более 250. (Если 40% больше 250, то цена должна быть 250);
- в зависимости от остатка на складе вывести "Спрос": до 3 (включительно) - высокий, до 10 (включительно) - средний, иначе низкий;
- добавить колонку "Наличие" в зависимости от количества: 1-2 шт - очень мало, 3-14 - в наличии, 15 и больше - много;
- отсортировать по цене по возрастанию, затем по Спросу от высокого к низкому, а затем по названию книги в алфавитном порядке.

Ответ:

SELECT CONCAT('Графоман и ', author) AS Автор,
CONCAT(title, '. Краткое содержание.') AS Название,
IF(price * 0.4 > 250, 250, price * 0.4) AS Цена,
IF(amount <= 3, 'высокий', IF(amount <= 10, 'средний', 'низкий')) AS Спрос,
IF(amount <= 2, 'очень мало', IF(amount < 15, 'в наличии', 'много')) AS Наличие
FROM book
ORDER BY Цена, 
    CASE Спрос
        WHEN 'высокий' THEN 1
        WHEN 'средний' THEN 2
        ELSE 3
    END,
    Название;
    
*****

3. Для клиентов у которых сумма заказов выше средней по суммам заказов клиентов (общей стоимости всех заказов клиентов), вывести имя, общую сумму всех заказов, количество заказов, количество заказанных книг. Этим клиентам мы предложим специальную программу лояльности! Информацию отсортировать по имени клиентов ( в алфавитном порядке).

Ответ:

SELECT client.name_client,
SUM(book.price * buy_book.amount) AS Общая_сумма_заказов,
COUNT(DISTINCT buy_book.buy_id) AS Заказов_всего,
SUM(buy_book.amount) AS Книг_всего
FROM book
    INNER JOIN buy_book USING (book_id)
    INNER JOIN buy USING (buy_id)
    INNER JOIN client USING (client_id)
GROUP BY 1
HAVING SUM(book.price * buy_book.amount) > AVG(book.price * buy_book.amount)
ORDER BY 1;

*****

4. Составить рейтинг книг в зависимости от того, какая книга принесет больше всего выручки (в процентах), при условии продажи всех книг. Рейтинг отсортировать по убыванию выручки. Выручка в процентах вычисляется как стоимость всех экземпляров книги деленное на суммарную стоимость всех экземпляров книг на складе и умноженное на 100, полученный результат округлить до двух знаков после запятой.

Ответ:

SELECT author, title, price, amount,
ROUND((price * amount / (SUM(price * amount) over())) * 100, 2) AS income_percent
FROM book
GROUP BY author, title, price, amount
ORDER BY income_percent DESC;

*****

5. Для каждого автора из таблицы author вывести количество книг, написанных им в каждом жанре.
Вывести: ФИО автора, жанр, количество.
Отсортировать: по фамилии, затем - по убыванию количества написанных книг, а затем в алфавитном порядке по названию жанра.
Важно! Реализовать задание одним запросом на выборку.

Ответ:

SELECT name_author, name_genre,
COUNT(amount) AS Количество
FROM author
    CROSS JOIN genre LEFT JOIN book USING(author_id, genre_id)
    GROUP BY name_author, name_genre
ORDER BY 1, 3 DESC, 2;

*****
